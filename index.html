<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GymPro Ultra Ultimate - Elite Tracking</title>
    
    <link rel="manifest" href="manifest.json">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com">
    
    <style>
        @import url('https://fonts.googleapis.com');
        body { font-family: 'Inter', sans-serif; background: #070b14; color: #f8fafc; }
        .glass { background: rgba(15, 23, 42, 0.8); backdrop-filter: blur(16px); border: 1px solid rgba(255,255,255,0.03); }
        .timer-active { animation: pulse 1.5s infinite; color: #fbbf24; text-shadow: 0 0 20px rgba(251,191,36,0.4); }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.7; } }
        .filter-btn.active { background: #fbbf24 !important; color: #070b14 !important; font-weight: 900; box-shadow: 0 4px 15px rgba(251,191,36,0.3); }
        input::-webkit-outer-spin-button, input::-webkit-inner-spin-button { -webkit-appearance: none; margin: 0; }
        @media print { .no-print { display: none !important; } }
        .custom-scroll::-webkit-scrollbar { width: 4px; }
        .custom-scroll::-webkit-scrollbar-thumb { background: #fbbf24; border-radius: 10px; }
    </style>
</head>
<body class="min-h-screen pb-20">

    <!-- Header -->
    <nav class="glass sticky top-0 z-50 border-b border-slate-800/50 p-4 no-print">
        <div class="max-w-6xl mx-auto flex justify-between items-center">
            <div class="flex items-center gap-2">
                <div class="bg-yellow-500 text-black px-2 py-1 rounded font-black italic">ULTIMATE</div>
                <h1 class="text-xl font-black italic tracking-tighter uppercase">GYM<span class="text-yellow-500">PRO</span></h1>
            </div>
            <div class="flex gap-2">
                <button onclick="window.print()" class="bg-slate-800 text-[10px] font-bold px-4 py-2 rounded-full border border-slate-700 hover:bg-slate-700 transition">PDF</button>
                <button onclick="clearLogs()" class="bg-red-900/20 text-red-500 text-[10px] font-bold px-4 py-2 rounded-full border border-red-900/30 hover:bg-red-500 hover:text-white transition">LIMPAR</button>
            </div>
        </div>
    </nav>

    <main class="max-w-6xl mx-auto p-4 lg:p-8 grid grid-cols-1 lg:grid-cols-12 gap-8">
        
        <!-- LADO ESQUERDO: AÇÃO -->
        <div class="lg:col-span-4 space-y-6 no-print">
            
            <!-- Timer Recovery -->
            <section class="glass p-6 rounded-[2rem] relative overflow-hidden border-l-4 border-yellow-500">
                <div class="text-center">
                    <p class="text-[9px] font-black text-yellow-500 uppercase tracking-[0.3em]">Recovery Timer</p>
                    <div id="time" class="text-6xl font-black my-2 tabular-nums tracking-tighter">01:00</div>
                    <div class="flex gap-2 justify-center">
                        <button onclick="startTimer(45)" class="bg-slate-800/50 hover:bg-yellow-500 hover:text-black px-4 py-2 rounded-xl text-[10px] font-black transition">45S</button>
                        <button onclick="startTimer(60)" class="bg-slate-800/50 hover:bg-yellow-500 hover:text-black px-4 py-2 rounded-xl text-[10px] font-black transition">60S</button>
                        <button onclick="startTimer(90)" class="bg-slate-800/50 hover:bg-yellow-500 hover:text-black px-4 py-2 rounded-xl text-[10px] font-black transition">90S</button>
                    </div>
                </div>
                <div id="timerBar" class="absolute bottom-0 left-0 h-1 bg-yellow-500 transition-all duration-1000" style="width: 0%"></div>
            </section>

            <!-- Novo Registro de Treino -->
            <section class="glass p-6 rounded-[2rem] border border-slate-800 shadow-2xl">
                <h2 class="text-sm font-black mb-6 flex items-center gap-2 uppercase italic"><i class="fas fa-plus-circle text-yellow-500"></i> Novo Registro</h2>
                <div class="space-y-4">
                    <input type="text" id="exercise" list="exercisesList" placeholder="Exercício" class="w-full bg-slate-900/50 border border-slate-800 rounded-2xl p-4 outline-none focus:border-yellow-500 transition">
                    <datalist id="exercisesList">
                        <option value="Supino Reto"> <option value="Agachamento Livre"> <option value="Levantamento Terra"> <option value="Puxada Alta"> <option value="Leg Press 45"> <option value="Rosca Direta">
                    </datalist>
                    
                    <div class="grid grid-cols-2 gap-3">
                        <select id="category" class="bg-slate-900/50 border border-slate-800 rounded-2xl p-4 text-xs outline-none">
                            <option value="Geral">Categoria</option>
                            <option value="Peito">Peito</option><option value="Costas">Costas</option>
                            <option value="Pernas">Pernas</option><option value="Ombros">Ombros</option><option value="Braços">Braços</option>
                        </select>
                        <select id="intensity" class="bg-slate-900/50 border border-slate-800 rounded-2xl p-4 text-xs outline-none">
                            <option value="6">Hipertrofia (MET 6)</option>
                            <option value="9">Força Bruta (MET 9)</option>
                            <option value="4">Cárdio/Recup. (MET 4)</option>
                        </select>
                    </div>

                    <div class="grid grid-cols-3 gap-2">
                        <div class="text-center">
                            <label class="text-[8px] font-bold text-slate-500 uppercase">Peso (kg)</label>
                            <input type="number" id="weight" placeholder="0" class="w-full bg-slate-900/50 border border-slate-800 rounded-xl p-3 text-center outline-none">
                        </div>
                        <div class="text-center">
                            <label class="text-[8px] font-bold text-slate-500 uppercase">Séries</label>
                            <input type="number" id="sets" value="3" class="w-full bg-slate-900/50 border border-slate-800 rounded-xl p-3 text-center outline-none">
                        </div>
                        <div class="text-center">
                            <label class="text-[8px] font-bold text-slate-500 uppercase">Reps</label>
                            <input type="number" id="reps" placeholder="0" class="w-full bg-slate-900/50 border border-slate-800 rounded-xl p-3 text-center outline-none">
                        </div>
                    </div>

                    <div class="flex flex-col">
                        <label class="text-[8px] font-bold text-slate-500 uppercase mb-1 ml-1">Duração Total (minutos)</label>
                        <input type="number" id="duration" placeholder="Ex: 45" class="w-full bg-slate-900/50 border border-slate-800 rounded-2xl p-4 outline-none focus:border-yellow-500">
                    </div>

                    <button onclick="addTraining()" class="w-full bg-yellow-500 hover:bg-yellow-400 text-black font-black py-5 rounded-2xl transition shadow-lg shadow-yellow-500/10 uppercase tracking-tighter">Salvar Performance</button>
                </div>
            </section>
        </div>

        <!-- LADO DIREITO: DASHBOARD E ANALYTICS -->
        <div class="lg:col-span-8 space-y-6">
            
            <!-- Cards de Stats -->
            <div class="grid grid-cols-2 md:grid-cols-4 gap-4 no-print">
                <div class="glass p-5 rounded-3xl border-b-2 border-yellow-500">
                    <p class="text-slate-500 text-[8px] font-black uppercase">Energia Gasta</p>
                    <h3 id="statKcal" class="text-2xl font-black italic">0 <span class="text-[10px] text-yellow-500 italic">KCAL</span></h3>
                </div>
                <div class="glass p-5 rounded-3xl border-b-2 border-blue-500">
                    <p class="text-slate-500 text-[8px] font-black uppercase">Tonelagem Total</p>
                    <h3 id="statVolume" class="text-2xl font-black italic">0 <span class="text-[10px] text-blue-500 italic">KG</span></h3>
                </div>
                <div class="glass p-5 rounded-3xl border-b-2 border-purple-500">
                    <p class="text-slate-500 text-[8px] font-black uppercase">Força Relativa</p>
                    <h3 id="statRelative" class="text-2xl font-black italic">0.0</h3>
                </div>
                <div class="glass p-5 rounded-3xl border-b-2 border-emerald-500">
                    <p class="text-slate-500 text-[8px] font-black uppercase">Seu Peso (kg)</p>
                    <input type="number" id="userWeight" onchange="saveProfile()" class="bg-transparent text-2xl font-black italic w-full outline-none focus:text-emerald-500">
                </div>
            </div>

            <!-- Gráfico de Evolução -->
            <div class="glass p-6 rounded-[2rem] h-64 no-print shadow-inner">
                <canvas id="evolutionChart"></canvas>
            </div>

            <!-- Medidas Corporais -->
            <section class="glass p-6 rounded-[2rem] border border-purple-900/20 no-print">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-xs font-black text-purple-400 uppercase italic"><i class="fas fa-chart-line mr-2"></i>Evolução de Medidas</h3>
                    <div id="measureGrowth" class="text-[10px] font-bold px-3 py-1 bg-purple-500/10 rounded-full text-purple-300 italic">Aguardando dados...</div>
                </div>
                <div class="grid grid-cols-2 md:grid-cols-4 gap-3">
                    <input type="number" id="mBiceps" placeholder="Bíceps (cm)" class="bg-slate-900/50 border border-slate-800 rounded-xl p-3 text-xs outline-none focus:border-purple-500">
                    <input type="number" id="mWaist" placeholder="Cintura (cm)" class="bg-slate-900/50 border border-slate-800 rounded-xl p-3 text-xs outline-none focus:border-purple-500">
                    <input type="number" id="mThigh" placeholder="Coxa (cm)" class="bg-slate-900/50 border border-slate-800 rounded-xl p-3 text-xs outline-none focus:border-purple-500">
                    <button onclick="saveMeasures()" class="bg-purple-600 hover:bg-purple-500 text-white font-black rounded-xl text-[10px] transition uppercase">Salvar</button>
                </div>
                <div id="measuresLog" class="mt-4 flex gap-2 overflow-x-auto pb-2 custom-scroll"></div>
            </section>

            <!-- Histórico Detalhado -->
            <div id="pdfContent" class="space-y-4">
                <div class="flex justify-between items-center px-2">
                    <h3 class="text-xl font-black italic uppercase tracking-tighter">Histórico <span class="text-yellow-500">Ultimate</span></h3>
                    <div class="flex gap-2 no-print">
                        <button onclick="filterLogs('All', this)" class="filter-btn active text-[9px] font-black px-4 py-2 rounded-full bg-slate-800 transition">TODOS</button>
                        <button onclick="filterLogs('Peito', this)" class="filter-btn text-[9px] font-black px-4 py-2 rounded-full bg-slate-800 transition">PEITO</button>
                        <button onclick="filterLogs('Pernas', this)" class="filter-btn text-[9px] font-black px-4 py-2 rounded-full bg-slate-800 transition">PERNAS</button>
                        <button onclick="filterLogs('Costas', this)" class="filter-btn text-[9px] font-black px-4 py-2 rounded-full bg-slate-800 transition">COSTAS</button>
                    </div>
                </div>
                <div id="logsContainer" class="space-y-3"></div>
            </div>
        </div>
    </main>

    <audio id="beep" src="https://actions.google.com"></audio>

    <script>
        // PWA SERVICE WORKER
        if ('serviceWorker' in navigator) { navigator.serviceWorker.register('sw.js'); }

        // ESTADO GLOBAL
        let trainings = JSON.parse(localStorage.getItem('gp_ult_logs')) || [];
        let measures = JSON.parse(localStorage.getItem('gp_ult_measures')) || [];
        let timerInt, chart, currentFilter = 'All';

        window.onload = () => {
            document.getElementById('userWeight').value = localStorage.getItem('gp_ult_weight') || 75;
            initChart();
            updateUI();
            renderMeasures();
        };

        // --- LÓGICA DE TREINO ---
        function addTraining() {
            const exercise = document.getElementById('exercise').value, category = document.getElementById('category').value;
            const weight = parseFloat(document.getElementById('weight').value) || 0, sets = parseInt(document.getElementById('sets').value) || 0;
            const reps = parseInt(document.getElementById('reps').value) || 0, duration = parseFloat(document.getElementById('duration').value) || 0;
            const met = parseFloat(document.getElementById('intensity').value), userW = parseFloat(document.getElementById('userWeight').value);

            if (!exercise || !duration) return alert("Exercício e Duração são obrigatórios!");

            const kcal = Math.round((met * 3.5 * userW / 200) * duration);
            const volume = weight * sets * reps;
            const log = { id: Date.now(), exercise, category, weight, sets, reps, duration, kcal, volume, date: new Date().toLocaleDateString('pt-BR') };

            trainings.unshift(log);
            localStorage.setItem('gp_ult_logs', JSON.stringify(trainings));
            updateUI();
            ['exercise','weight','reps','duration'].forEach(id => document.getElementById(id).value = '');
        }

        function updateUI(filter = currentFilter) {
            currentFilter = filter;
            const container = document.getElementById('logsContainer');
            let tKcal = 0, tVol = 0;
            
            trainings.forEach(t => { tKcal += t.kcal; tVol += t.volume; });
            const userW = parseFloat(document.getElementById('userWeight').value) || 1;
            const relForce = (tVol / (trainings.length || 1) / userW).toFixed(2);

            const filtered = filter === 'All' ? trainings : trainings.filter(t => t.category === filter);
            container.innerHTML = filtered.map(t => `
                <div class="glass p-5 rounded-[1.5rem] flex justify-between items-center border-l-4 border-yellow-500/50 hover:border-yellow-500 transition">
                    <div>
                        <p class="text-[8px] font-black text-slate-500 uppercase">${t.date} | ${t.category}</p>
                        <h4 class="font-black text-white text-sm uppercase italic tracking-tight">${t.exercise}</h4>
                        <p class="text-xs text-slate-400 font-bold">${t.sets}x${t.reps} • ${t.weight}KG</p>
                    </div>
                    <div class="flex items-center gap-4">
                        <div class="text-right">
                            <p class="text-[10px] font-black text-yellow-500">${t.kcal} KCAL</p>
                            <p class="text-[10px] font-black text-blue-400">${t.volume} VOL</p>
                        </div>
                        <button onclick="deleteLog(${t.id})" class="text-slate-700 hover:text-red-500 no-print transition"><i class="fas fa-trash"></i></button>
                    </div>
                </div>`).join('') || '<div class="text-center py-10 italic text-slate-700 font-bold uppercase">Sem Registros</div>';

            document.getElementById('statKcal').innerHTML = `${tKcal} <span class="text-[10px] text-yellow-500 italic">KCAL</span>`;
            document.getElementById('statVolume').innerHTML = `${tVol} <span class="text-[10px] text-blue-500 italic">KG</span>`;
            document.getElementById('statRelative').innerText = isNaN(relForce) ? "0.0" : relForce;
            updateChart();
        }

        // --- MEDIDAS ---
        function saveMeasures() {
            const m = {
                id: Date.now(), date: new Date().toLocaleDateString('pt-BR'),
                biceps: parseFloat(document.getElementById('mBiceps').value) || 0,
                waist: parseFloat(document.getElementById('mWaist').value) || 0,
                thigh: parseFloat(document.getElementById('mThigh').value) || 0
            };
            if(!m.biceps && !m.waist) return alert("Preencha ao menos uma medida!");
            measures.unshift(m);
            localStorage.setItem('gp_ult_measures', JSON.stringify(measures));
            renderMeasures();
        }

        function renderMeasures() {
            const container = document.getElementById('measuresLog');
            container.innerHTML = measures.map(m => `
                <div class="min-w-[110px] bg-slate-900/80 p-3 rounded-2xl border border-slate-800 text-center">
                    <p class="text-[8px] font-black text-slate-500 mb-1">${m.date}</p>
                    <p class="text-xs font-black text-purple-400">B: ${m.biceps}cm</p>
                    <p class="text-[9px] font-bold text-slate-400">C: ${m.waist}cm</p>
                </div>`).join('');
            
            if(measures.length >= 2) {
                const diff = (measures[0].biceps - measures[measures.length-1].biceps).toFixed(1);
                document.getElementById('measureGrowth').innerText = `Evolução Bíceps: ${diff > 0 ? '+' : ''}${diff}cm`;
            }
        }

        // --- GRÁFICO E TOOLS ---
        function initChart() {
            const ctx = document.getElementById('evolutionChart').getContext('2d');
            chart = new Chart(ctx, {
                type: 'line',
                data: { labels: [], datasets: [{ label: 'Volume', data: [], borderColor: '#fbbf24', tension: 0.4, fill: true, backgroundColor: 'rgba(251,191,36,0.05)', borderWidth: 3, pointRadius: 2 }] },
                options: { 
                    responsive: true, maintainAspectRatio: false, 
                    plugins: { legend: { display: false } },
                    scales: { 
                        y: { display: false }, 
                        x: { grid: { display: false }, ticks: { color: '#475569', font: { size: 9, weight: 'bold' } } } 
                    }
                }
            });
        }

        function updateChart() {
            if (!chart) return;
            const lastData = [...trainings].reverse().slice(-10);
            chart.data.labels = lastData.map(t => t.exercise.substring(0,6));
            chart.data.datasets[0].data = lastData.map(t => t.volume);
            chart.update();
        }

        function startTimer(s) {
            clearInterval(timerInt);
            let left = s; const disp = document.getElementById('time'), bar = document.getElementById('timerBar');
            disp.classList.add('timer-active');
            timerInt = setInterval(() => {
                const sc = left % 60;
                disp.innerText = `${Math.floor(left/60).toString().padStart(2,'0')}:${sc.toString().padStart(2,'0')}`;
                bar.style.width = `${((s - left) / s) * 100}%`;
                if (left-- <= 0) { clearInterval(timerInt); document.getElementById('beep').play(); disp.classList.remove('timer-active'); }
            }, 1000);
        }

        function deleteLog(id) { if(confirm("Excluir registro?")) { trainings = trainings.filter(t => t.id !== id); localStorage.setItem('gp_ult_logs', JSON.stringify(trainings)); updateUI(); } }
        function clearLogs() { if(confirm("LIMPAR TODOS OS DADOS PERMANENTEMENTE?")) { localStorage.clear(); location.reload(); } }
        function saveProfile() { localStorage.setItem('gp_ult_weight', document.getElementById('userWeight').value); updateUI(); }
        function filterLogs(f, el) { updateUI(f); document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active')); el.classList.add('active'); }
    </script>
</body>
</html>
